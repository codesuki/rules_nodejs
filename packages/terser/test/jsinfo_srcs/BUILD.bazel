load("@npm_bazel_jasmine//:index.from_src.bzl", "jasmine_node_test")
load("@npm_bazel_terser//:index.from_src.bzl", "terser_minified")
load(":consumes_jsinfo.bzl", "consumes_jsinfo")

# Use the JSInfo provider to find inputs from *_bundle rule
load(":produces_jsinfo.bzl", "produces_jsinfo")

produces_jsinfo(
    name = "in",
    esnext_srcs = ["esnext.mjs"],
    named_srcs = ["named.umd.js"],
)

terser_minified(
    name = "terser",
    srcs = [":in"],
    sourcemap = False,
)

consumes_jsinfo(
    name = "out",
    src = ":terser",
)

jasmine_node_test(
    name = "test",
    srcs = [
        "terser_spec.js",
    ],
    deps = [
        ":out",
        ":terser.js",
    ],
)

# Case 4: test that terser also outputs a JS provider
